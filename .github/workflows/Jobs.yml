name: Create SQL Server Agent Jobs

on:
  workflow_dispatch:

jobs:
  create-sql-agent-jobs:
    runs-on: [self-hosted, windows]

    steps: 
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Run PowerShell script to create jobs
        env:
          SQL_SERVER: ${{ secrets.SQL_SERVER }}
          SQL_USERNAME: ${{ secrets.SQL_USERNAME }}
          SQL_PASSWORD: ${{ secrets.SQL_PASSWORD }}
        shell: powershell
        run: |
          $ErrorActionPreference = "Stop"
          .\Timesheet\SqlScripts\create_jobs.ps1 `
            -SqlServer $env:SQL_SERVER `
            -Username $env:SQL_USERNAME `
            -Password $env:SQL_PASSWORD
